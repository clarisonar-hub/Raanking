<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rank Dose</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:'Orbitron',sans-serif;
  background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);
  color:#fff;
  overflow-x:hidden;
}
h1{
  text-align:center;
  margin:20px 0;
  color:#00fff7;
  text-shadow:0 0 10px #00fff7,0 0 20px #00fff7;
}
canvas{display:block;}
.sidebar{
  position:fixed;
  top:60px;
  left:10px;
  display:flex;
  flex-direction:column;
  gap:10px;
  z-index:50;
}
.sidebar button{
  padding:10px 20px;
  border-radius:15px;
  font-weight:bold;
  font-size:16px;
  background:rgba(0,0,0,0.6);
  color:#fff;
  text-shadow:0 0 5px #000;
  cursor:pointer;
  transition:0.3s;
}
.sidebar button:hover{
  background:#00ff00;
  color:#000;
  box-shadow:0 0 15px #00ff00 inset;
}
.ranking-panel{
  position:fixed;
  top:50px;
  right:10px;
  width:300px;
  max-height:80vh;
  overflow:auto;
  background: rgba(0,0,0,0.6);
  padding:15px;
  border-radius:15px;
  box-shadow:0 0 20px #00fff7;
  display:none;
}
.ranking-panel h2{
  text-align:center;
  color:#ff00ff;
  text-shadow:0 0 5px #ff00ff;
  margin-bottom:10px;
}
.bot-entry{
  margin:5px 0;
  display:flex;
  flex-direction:column;
}
.month-badge{
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  background:#ff00ff;
  padding:10px 20px;
  border-radius:20px;
  font-weight:bold;
  text-shadow:0 0 5px #ff00ff;
  animation:glow 1.5s infinite alternate;
  z-index:20;
}
@keyframes glow{
  from{box-shadow:0 0 10px #ff00ff;}
  to{box-shadow:0 0 30px #ff00ff;}
}
.bot-car{
  position:absolute;
  width:70px;
  height:30px;
  border-radius:10px;
  text-align:center;
  line-height:30px;
  font-weight:bold;
  color:#fff;
  font-size:14px;
  z-index:5;
  text-shadow:0 0 10px #000;
  display:none;
}
.countdown{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:80px;
  font-weight:bold;
  color:#00ff00;
  text-shadow:0 0 20px #00ff00,0 0 40px #0ff;
  z-index:100;
  display:none;
}
@media(max-width:600px){
  .ranking-panel{width:90%;right:5%;top:60px;padding:10px;}
  .sidebar{top:60px;left:5px;}
  .sidebar button{font-size:14px;padding:8px 15px;}
  .bot-car{width:50px;height:25px;font-size:12px;line-height:25px;}
  .countdown{font-size:50px;}
}
</style>
</head>
<body>
<h1>Rank Dose</h1>

<div class="sidebar">
  <button id="startBtn">‚ñ∂ START</button>
  <button id="resetBtn">‚ü≤ RESET</button>
  <button id="tableBtn">üìã Tabela de Lucros</button>
  <button id="simulateBtn">üíª Simular Vendas</button>
</div>

<div class="ranking-panel" id="rankingPanel">
  <h2>Classifica√ß√£o</h2>
  <div id="rankingBots"></div>
</div>

<div class="month-badge">üèÜ Outubro</div>
<div class="countdown" id="countdown">3</div>
<canvas id="trackCanvas"></canvas>

<script>
const canvas=document.getElementById('trackCanvas');
const ctx=canvas.getContext('2d');
function resizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

// Produtos
const produtos=[
  {nome:"Combo de Sushi Simples", preco:25, custo:10, bot:5},
  {nome:"Lanche Econ√¥mico", preco:10, custo:3, bot:2},
  {nome:"Pastel em Cone", preco:30, custo:15, bot:5},
  {nome:"Refrigerante lata", preco:8, custo:4, bot:1.5},
  {nome:"√Ågua 500ml", preco:5, custo:2, bot:1},
];

// Bots todos Level 1
const bots=[
  {id:'bot1Car',nome:'apelidoSPgo',color:'#FFD700',level:1,vendas:[],t:0,trails:[]},
  {id:'bot2Car',nome:'TurboBot',color:'#00ffbf',level:1,vendas:[],t:0,trails:[]},
  {id:'bot3Car',nome:'FlashVend',color:'#ffbf00',level:1,vendas:[],t:0,trails:[]},
  {id:'bot4Car',nome:'SushiMasterX',color:'#00bfff',level:1,vendas:[],t:0,trails:[]},
  {id:'bot5Car',nome:'VelozByte',color:'#ff4000',level:1,vendas:[],t:0,trails:[]},
];

let raceStarted=false;
const totalLaps=1;
let diaSimulado=1;

// C√°lculos
function totalVendasBot(bot){return bot.vendas.flat().reduce((s,v)=>s+v.qtd,0);}
function totalVendasR(bot){return bot.vendas.flat().reduce((s,v)=>{const p=produtos.find(prod=>prod.nome===v.produto);return s+(p?p.preco*v.qtd:0);},0);}
function totalLucroBot(bot){return bot.vendas.flat().reduce((s,v)=>{const p=produtos.find(prod=>prod.nome===v.produto);return s+(p?p.bot*v.qtd:0);},0);}
function totalLucroLoja(bot){return bot.vendas.flat().reduce((s,v)=>{const p=produtos.find(prod=>prod.nome===v.produto);return s+((p?p.preco-p.custo:0)*v.qtd);},0);}

// Ranking
function atualizarRanking(){
  const rankingDiv=document.getElementById('rankingBots');
  rankingDiv.innerHTML='';
  const botsOrdenados=bots.slice().sort((a,b)=>totalLucroBot(b)-totalLucroBot(a));
  botsOrdenados.forEach((bot,i)=>{
    const div=document.createElement('div');
    div.className='bot-entry';
    div.innerHTML=`<strong>#${i+1} ${bot.nome} (Level ${bot.level})</strong><br>
                   Total Vendas: ${totalVendasBot(bot)}<br>
                   Total Vendas (R$): ${totalVendasR(bot).toFixed(2)}<br>
                   Lucro Bot: R$ ${totalLucroBot(bot).toFixed(2)}<br>
                   Lucro Loja: R$ ${totalLucroLoja(bot).toFixed(2)}`;
    rankingDiv.appendChild(div);
  });
}

// DOM bots
bots.forEach(bot=>{
  const div=document.createElement('div');
  div.id=bot.id;
  div.className='bot-car';
  div.style.background=bot.color;
  div.innerText=bot.nome;
  document.body.appendChild(div);
});

// Pista centralizada
function getTrackPosition(bot){
  const centerX=canvas.width/2;
  const centerY=canvas.height/2+50;
  const trackWidth=canvas.width-400;
  const trackSpacing = 90;
  const angle=bot.t*2*Math.PI;
  const y=centerY + bots.indexOf(bot)*trackSpacing;
  const x=centerX + Math.sin(angle)*trackWidth/2;
  return {x,y};
}

// Draw
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  bots.forEach(bot=>{
    const pos=getTrackPosition(bot);
    bot.trails.push({x:pos.x,y:pos.y});
    if(bot.trails.length>30) bot.trails.shift();
    bot.trails.forEach((p,i)=>{
      ctx.fillStyle=bot.color;
      ctx.globalAlpha=i/bot.trails.length;
      ctx.beginPath();
      ctx.arc(p.x,p.y,5,0,2*Math.PI);
      ctx.fill();
    });
    ctx.globalAlpha=1;

    ctx.strokeStyle='#00ffff';
    ctx.shadowBlur=15;
    ctx.shadowColor='#00ffff';
    ctx.lineWidth=6;
    ctx.beginPath();
    const centerX=canvas.width/2;
    const centerY=canvas.height/2+50;
    const trackWidth=canvas.width-400;
    const trackSpacing = 90;
    ctx.ellipse(centerX, centerY + bots.indexOf(bot)*trackSpacing, trackWidth/2, trackSpacing/2, 0,0,2*Math.PI);
    ctx.stroke();
    ctx.shadowBlur=0;

    ctx.fillStyle=`rgba(0,255,0,${Math.abs(Math.sin(Date.now()/300))})`;
    ctx.fillRect(centerX + trackWidth/2 -5, pos.y-15, 10,30);

    const botElem=document.getElementById(bot.id);
    botElem.style.display='block';
    botElem.style.top=(pos.y-15)+'px';
    botElem.style.left=(pos.x-35)+'px';
  });
}

// Animate
function animate(){
  if(!raceStarted) return;
  let finished=true;
  const maxLucro=Math.max(...bots.map(b=>totalLucroBot(b)));
  bots.forEach(bot=>{
    const lucro=totalLucroBot(bot);
    if(bot.t<totalLaps){
      bot.t+=0.002 + 0.003*(lucro/maxLucro);
      if(bot.t>totalLaps) bot.t=totalLaps;
      finished=false;
    }
  });
  draw();
  if(!finished) requestAnimationFrame(animate);
  else{
    raceStarted=false;
    confettiEffect();
    bots.forEach(bot=>document.getElementById(bot.id).style.display='none');
    document.querySelectorAll('.sidebar button').forEach(b=>b.style.display='block');
    document.getElementById('rankingPanel').style.display='block';
    atualizarRanking();
  }
}

// Confetti
function confettiEffect(){
  const confetti=[];
  for(let i=0;i<100;i++){
    confetti.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,dx:(Math.random()-0.5)*4,dy:Math.random()*3+2,color:`hsl(${Math.random()*360},100%,50%)`});
  }
  function drawConfetti(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    confetti.forEach(c=>{
      ctx.fillStyle=c.color;
      ctx.fillRect(c.x,c.y,5,5);
      c.x+=c.dx;c.y+=c.dy;
      if(c.y>canvas.height)c.y=0;
      if(c.x>canvas.width)c.x=0;
      if(c.x<0)c.x=canvas.width;
    });
    if(!raceStarted) requestAnimationFrame(drawConfetti);
  }
  drawConfetti();
}

// Bot√µes
const countdownElem=document.getElementById('countdown');
document.getElementById('startBtn').addEventListener('click',()=>{
  if(raceStarted) return;
  countdownElem.style.display='block';
  let count=3;
  countdownElem.innerText=count;
  document.querySelectorAll('.sidebar button').forEach(b=>b.style.display='none');

  const countdownInterval=setInterval(()=>{
    count--;
    if(count>0) countdownElem.innerText=count;
    else{
      clearInterval(countdownInterval);
      countdownElem.innerText='GO!';
      bots.forEach(bot=>{ bot.t=0; bot.trails=[]; });
      raceStarted=true;
      document.getElementById('rankingPanel').style.display='none';
      animate();
      setTimeout(()=>countdownElem.style.display='none',500);
    }
  },1000);
});

document.getElementById('resetBtn').addEventListener('click',()=>{
  raceStarted=false;
  bots.forEach(bot=>bot.t=0, bot.trails=[]);
  bots.forEach(bot=>document.getElementById(bot.id).style.display='none');
  document.querySelectorAll('.sidebar button').forEach(b=>b.style.display='block');
  document.getElementById('rankingPanel').style.display='none';
  draw();
});

document.getElementById('tableBtn').addEventListener('click',()=>{
  let tableText='Produto | Pre√ßo | Custo | Lucro Bot\n';
  produtos.forEach(p=>{tableText+=`${p.nome} | R$${p.preco} | R$${p.custo} | R$${p.bot}\n`;});
  alert(tableText);
});

// Simula√ß√£o de Vendas
document.getElementById('simulateBtn').addEventListener('click',()=>{
  bots.forEach(bot=>{
    bot.vendas=[];
    const numPedidos=Math.floor(Math.random()*4)+2;
    for(let i=0;i<numPedidos;i++){
      const pedido=[];
      const familia = Math.random()>0.5;
      if(familia){
        pedido.push({produto:"Combo de Sushi Simples",qtd:2+Math.floor(Math.random()*3)});
        pedido.push({produto:"Refrigerante lata",qtd:2+Math.floor(Math.random()*3)});
      } else {
        pedido.push({produto:"Pastel em Cone",qtd:2+Math.floor(Math.random()*3)});
        pedido.push({produto:"√Ågua 500ml",qtd:2+Math.floor(Math.random()*3)});
      }
      if(Math.random()>0.5) pedido.push({produto:"Lanche Econ√¥mico",qtd:1+Math.floor(Math.random()*3)});
      bot.vendas.push(pedido);
    }
  });

  const simWindow=window.open('','Simula√ß√£o','width=650,height=650');
  simWindow.document.write(`<h2>Simula√ß√£o de Vendas - Dia ${diaSimulado}</h2>`);
  bots.forEach(bot=>{
    simWindow.document.write(`<h3>${bot.nome} (Level ${bot.level})</h3>`);
    bot.vendas.forEach((pedido,index)=>{
      simWindow.document.write(`<strong>Pedido ${index+1}:</strong><br>`);
      pedido.forEach(p=>{
        const prod=produtos.find(pr=>pr.nome===p.produto);
        const totalR=p.qtd*prod.preco;
        const lucroLoja=p.qtd*(prod.preco-prod.custo);
        simWindow.document.write(`${p.qtd}x ${p.produto} => R$ ${totalR.toFixed(2)} | Lucro Loja: R$ ${lucroLoja.toFixed(2)}<br>`);
      });
    });
    simWindow.document.write(`<strong>Lucro Bot: R$ ${totalLucroBot(bot).toFixed(2)} | Lucro Loja Total: R$ ${totalLucroLoja(bot).toFixed(2)}</strong><hr>`);
  });
  simWindow.document.write(`<button id="backBtn">Atualizar Vendas / Voltar</button>`);
  simWindow.document.write(`<script>
    document.getElementById('backBtn').addEventListener('click',()=>{
      window.opener.atualizarRanking();
      window.close();
    });
  <\/script>`);
  diaSimulado++;
});

draw();
</script>
</body>
</html>
