<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rank Dose</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:'Orbitron',sans-serif;
  background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);
  color:#fff;
  overflow-x:hidden;
}
h1{
  text-align:center;
  margin:20px 0;
  color:#00fff7;
  text-shadow:0 0 10px #00fff7,0 0 20px #00fff7;
}
canvas{display:block;}
.sidebar{
  position:fixed;
  top:60px;
  left:10px;
  display:flex;
  flex-direction:column;
  gap:10px;
  z-index:50;
}
.sidebar button{
  padding:10px 20px;
  border-radius:15px;
  font-weight:bold;
  font-size:16px;
  background:rgba(0,0,0,0.6);
  color:#fff;
  text-shadow:0 0 5px #000;
  cursor:pointer;
  transition:0.3s;
}
.sidebar button:hover{
  background:#00ff00;
  color:#000;
  box-shadow:0 0 15px #00ff00 inset;
}
.ranking-panel{
  position:fixed;
  top:50px;
  right:10px;
  width:300px;
  max-height:80vh;
  overflow:auto;
  background: rgba(0,0,0,0.8);
  padding:15px;
  border-radius:15px;
  box-shadow:0 0 20px #00fff7;
  display:none;
}
.ranking-panel h2{
  text-align:center;
  color:#ff00ff;
  text-shadow:0 0 5px #ff00ff;
  margin-bottom:10px;
}
.bot-entry{
  margin:5px 0;
  display:flex;
  flex-direction:column;
}
.month-badge{
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  background:#ff00ff;
  padding:10px 20px;
  border-radius:20px;
  font-weight:bold;
  text-shadow:0 0 5px #ff00ff;
  animation:glow 1.5s infinite alternate;
  z-index:20;
}
@keyframes glow{
  from{box-shadow:0 0 10px #ff00ff;}
  to{box-shadow:0 0 30px #ff00ff;}
}
.bot-car{
  position:absolute;
  width:70px;
  height:30px;
  border-radius:10px;
  text-align:center;
  line-height:30px;
  font-weight:bold;
  color:#fff;
  font-size:14px;
  z-index:5;
  text-shadow:0 0 10px #000;
  display:none;
}
.countdown{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:80px;
  font-weight:bold;
  color:#00ff00;
  text-shadow:0 0 20px #00ff00,0 0 40px #0ff;
  z-index:100;
  display:none;
}
.modal{
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  background:rgba(0,0,0,0.9);
  padding:20px;
  border-radius:15px;
  box-shadow:0 0 20px #00fff7;
  z-index:200;
  display:none;
  max-width:90%;
  max-height:80%;
  overflow:auto;
}
.modal h3{
  text-align:center;
  color:#ff00ff;
  text-shadow:0 0 5px #ff00ff;
  margin-bottom:10px;
}
.modal button{
  display:block;
  margin:10px auto 0;
  padding:8px 15px;
  font-weight:bold;
  border-radius:10px;
  background:#00ff00;
  color:#000;
  cursor:pointer;
}
@media(max-width:600px){
  .ranking-panel{width:90%;right:5%;top:60px;padding:10px;}
  .sidebar{top:60px;left:5px;}
  .sidebar button{font-size:14px;padding:8px 15px;}
  .bot-car{width:50px;height:25px;font-size:12px;line-height:25px;}
  .countdown{font-size:50px;}
}
</style>
</head>
<body>
<h1>Rank Dose</h1>

<div class="sidebar">
  <button id="startBtn">‚ñ∂ START</button>
  <button id="resetBtn">‚ü≤ RESET</button>
  <button id="tableBtn">üìã Tabela de Lucros</button>
</div>

<div class="ranking-panel" id="rankingPanel">
  <h2>Classifica√ß√£o</h2>
  <div id="rankingBots"></div>
</div>

<div class="month-badge">üèÜ Outubro</div>
<div class="countdown" id="countdown">3</div>

<div class="modal" id="modalTable">
  <h3>Tabela de Lucros</h3>
  <pre id="modalContent"></pre>
  <button id="closeModal">Fechar</button>
</div>

<canvas id="trackCanvas"></canvas>

<script>
const canvas=document.getElementById('trackCanvas');
const ctx=canvas.getContext('2d');
function resizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

// Produtos
const produtos=[
  {nome:"Combo de Sushi Simples", preco:25, custo:10, bot:5},
  {nome:"Lanche Econ√¥mico", preco:10, custo:3, bot:2},
  {nome:"Pastel em Cone", preco:30, custo:15, bot:5},
  {nome:"Refrigerante lata", preco:8, custo:4, bot:1.5},
  {nome:"√Ågua 500ml", preco:5, custo:2, bot:1},
];

// Bots com Level
const bots=[
  {id:'bot1Car',nome:'apelidoSPgo',level:1,color:'#FFD700',vendas:[{produto:"Combo de Sushi Simples",qtd:10},{produto:"Lanche Econ√¥mico",qtd:5}],t:0,trails:[]},
  {id:'bot2Car',nome:'TurboBot',level:1,color:'#00ffbf',vendas:[{produto:"Combo de Sushi Simples",qtd:5},{produto:"Pastel em Cone",qtd:5}],t:0,trails:[]},
  {id:'bot3Car',nome:'FlashVend',level:1,color:'#ffbf00',vendas:[{produto:"Lanche Econ√¥mico",qtd:8}],t:0,trails:[]},
  {id:'bot4Car',nome:'SushiMasterX',level:1,color:'#00bfff',vendas:[{produto:"Pastel em Cone",qtd:5}],t:0,trails:[]},
  {id:'bot5Car',nome:'VelozByte',level:1,color:'#ff4000',vendas:[{produto:"Refrigerante lata",qtd:3}],t:0,trails:[]},
];

let raceStarted=false;
const totalLaps=1;

// C√°lculos
function totalVendasBot(bot){return bot.vendas.reduce((s,v)=>s+v.qtd,0);}
function totalVendasR(bot){return bot.vendas.reduce((s,v)=>{const p=produtos.find(prod=>prod.nome===v.produto);return s+(p?p.preco*v.qtd:0);},0);}
function totalLucroBot(bot){return bot.vendas.reduce((s,v)=>{const p=produtos.find(prod=>prod.nome===v.produto);return s+(p?p.bot*v.qtd:0);},0);}

// Ranking
function atualizarRanking(){
  const rankingDiv=document.getElementById('rankingBots');
  rankingDiv.innerHTML='';
  const botsOrdenados=bots.slice().sort((a,b)=>totalLucroBot(b)-totalLucroBot(a));
  botsOrdenados.forEach((bot,i)=>{
    const div=document.createElement('div');
    div.className='bot-entry';
    div.innerHTML=`<strong>#${i+1} ${bot.nome} (Level ${bot.level})</strong><br>Total Vendas: ${totalVendasBot(bot)}<br>Total Vendas (R$): ${totalVendasR(bot).toFixed(2)}<br>Total Bot: R$ ${totalLucroBot(bot).toFixed(2)}`;
    rankingDiv.appendChild(div);
  });
}

// DOM bots
bots.forEach(bot=>{
  const div=document.createElement('div');
  div.id=bot.id;
  div.className='bot-car';
  div.style.background=bot.color;
  div.innerText=bot.nome;
  document.body.appendChild(div);
});

// Pista curva centralizada
function getTrackPosition(bot){
  const centerX=canvas.width/2;
  const centerY=canvas.height/2;
  const trackWidth=canvas.width-400;
  const trackSpacing=90;
  const angle = bot.t*2*Math.PI;
  const y = centerY + bots.indexOf(bot)*trackSpacing - (trackSpacing*(bots.length-1))/2;
  const x = centerX + Math.sin(angle)*trackWidth/2;
  return {x,y};
}

// Draw
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  bots.forEach(bot=>{
    const pos=getTrackPosition(bot);
    bot.trails.push({x:pos.x,y:pos.y});
    if(bot.trails.length>30) bot.trails.shift();
    bot.trails.forEach((p,i)=>{
      ctx.fillStyle=bot.color;
      ctx.globalAlpha=i/bot.trails.length;
      ctx.beginPath();
      ctx.arc(p.x,p.y,5,0,2*Math.PI);
      ctx.fill();
    });
    ctx.globalAlpha=1;

    ctx.strokeStyle='#00ffff';
    ctx.shadowBlur=15;
    ctx.shadowColor='#00ffff';
    ctx.lineWidth=6;
    ctx.beginPath();
    ctx.ellipse(canvas.width/2, canvas.height/2 + bots.indexOf(bot)*90 - (90*(bots.length-1))/2, (canvas.width-400)/2, 45, 0,0,2*Math.PI);
    ctx.stroke();
    ctx.shadowBlur=0;

    ctx.fillStyle=`rgba(0,255,0,${Math.abs(Math.sin(Date.now()/300))})`;
    ctx.fillRect(canvas.width/2 + (canvas.width-400)/2 -5, pos.y-15, 10,30);

    const botElem=document.getElementById(bot.id);
    botElem.style.display='block';
    botElem.style.top=(pos.y-15)+'px';
    botElem.style.left=(pos.x-35)+'px';
  });
}

// Animate
function animate(){
  if(!raceStarted) return;
  let finished=true;
  bots.forEach(bot=>{
    if(bot.t<totalLaps){
      bot.t += 0.002*bot.level; // velocidade influenciada pelo level
      if(bot.t>totalLaps) bot.t=totalLaps;
      finished=false;
    }
  });
  draw();
  if(!finished) requestAnimationFrame(animate);
  else{
    raceStarted=false;
    confettiEffect();
    bots.forEach(bot=>document.getElementById(bot.id).style.display='none');
    document.querySelectorAll('.sidebar button').forEach(b=>b.style.display='block');
    document.getElementById('rankingPanel').style.display='block';
    atualizarRanking();
    playSound('win');
  }
}

// Confetes aprimorados
function confettiEffect(){
  const confetti=[];
  for(let i=0;i<200;i++){
    confetti.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,dx:(Math.random()-0.5)*4,dy:Math.random()*2+1,color:`hsl(${Math.random()*360},100%,50%)`,size:Math.random()*5+2});
  }
  function drawConfetti(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    confetti.forEach(c=>{
      ctx.fillStyle=c.color;
      ctx.fillRect(c.x,c.y,c.size,c.size);
      c.x+=c.dx;c.y+=c.dy;
      if(c.y>canvas.height)c.y=0;
      if(c.x>canvas.width)c.x=0;
      if(c.x<0)c.x=canvas.width;
    });
    if(!raceStarted) requestAnimationFrame(drawConfetti);
  }
  drawConfetti();
}

// Sons
function playSound(type){
  let audio;
  if(type==='count') audio=new Audio('https://freesound.org/data/previews/146/146726_2615115-lq.mp3');
  else if(type==='go') audio=new Audio('https://freesound.org/data/previews/331/331912_3248244-lq.mp3');
  else if(type==='win') audio=new Audio('https://freesound.org/data/previews/331/331912_3248244-lq.mp3');
  if(audio) audio.play();
}

// Bot√µes
const countdownElem=document.getElementById('countdown');
document.getElementById('startBtn').addEventListener('click',()=>{
  if(raceStarted) return;
  countdownElem.style.display='block';
  let count=3;
  countdownElem.innerText=count;
  document.querySelectorAll('.sidebar button').forEach(b=>b.style.display='none');

  const countdownInterval=setInterval(()=>{
    playSound('count');
    count--;
    if(count>0) countdownElem.innerText=count;
    else{
      clearInterval(countdownInterval);
      countdownElem.innerText='GO!';
      playSound('go');
      bots.forEach(bot=>{ bot.t=0; bot.trails=[]; });
      raceStarted=true;
      document.getElementById('rankingPanel').style.display='none';
      animate();
      setTimeout(()=>countdownElem.style.display='none',500);
    }
  },1000);
});

document.getElementById('resetBtn').addEventListener('click',()=>{
  raceStarted=false;
  bots.forEach(bot=>bot.t=0, bot.trails=[]);
  bots.forEach(bot=>document.getElementById(bot.id).style.display='none');
  document.querySelectorAll('.sidebar button').forEach(b=>b.style.display='block');
  document.getElementById('rankingPanel').style.display='none';
  draw();
});

// Modal de tabela
document.getElementById('tableBtn').addEventListener('click',()=>{
  let content='';
  produtos.forEach(p=>{content+=`${p.nome} | R$${p.preco} | R$${p.custo} | R$${p.bot}\n`;});
  document.getElementById('modalContent').innerText=content;
  document.getElementById('modalTable').style.display='block';
});

document.getElementById('closeModal').addEventListener('click',()=>{
  document.getElementById('modalTable').style.display='none';
});

draw();
</script>
</body>
</html>
